<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add neighbor constraints — add_neighbor_constraints • prioritizr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>


<!-- docsearch -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Add neighbor constraints — add_neighbor_constraints" />

<meta property="og:description" content="Add constraints to a conservation planning problem to ensure
that all selected planning units in the solution have at least a certain
number of neighbors that are also selected in the solution." />

<meta property="og:image" content="http://prioritizr.github.io/prioritizr/logo.png" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script>



<!-- docsearch -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">4.0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/gurobi_installation.html">Gurobi Installation Guide</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication Record</a>
    </li>
    <li>
      <a href="../articles/zones.html">Management Zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/prioritizr/prioritizr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add neighbor constraints</h1>
    <small class="dont-index">Source: <a href='https://github.com/prioritizr/prioritizr/blob/master/R/add_neighbor_contraints.R'><code>R/add_neighbor_contraints.R</code></a></small>
    <div class="hidden name"><code>add_neighbor_constraints.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Add constraints to a conservation planning <code>problem</code> to ensure
that all selected planning units in the solution have at least a certain
number of neighbors that are also selected in the solution.</p>
    
    </div>

    <pre class="usage"><span class='co'># S4 method for ConservationProblem,ANY,ANY,ANY</span>
<span class='fu'>add_neighbor_constraints</span>(<span class='no'>x</span>, <span class='no'>k</span>, <span class='no'>zones</span>, <span class='no'>data</span>)

<span class='co'># S4 method for ConservationProblem,ANY,ANY,data.frame</span>
<span class='fu'>add_neighbor_constraints</span>(<span class='no'>x</span>, <span class='no'>k</span>, <span class='no'>zones</span>, <span class='no'>data</span>)

<span class='co'># S4 method for ConservationProblem,ANY,ANY,matrix</span>
<span class='fu'>add_neighbor_constraints</span>(<span class='no'>x</span>, <span class='no'>k</span>, <span class='no'>zones</span>, <span class='no'>data</span>)

<span class='co'># S4 method for ConservationProblem,ANY,ANY,array</span>
<span class='fu'>add_neighbor_constraints</span>(<span class='no'>x</span>, <span class='no'>k</span>, <span class='no'>zones</span>, <span class='no'>data</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code><a href='ConservationProblem-class.html'>ConservationProblem-class</a></code> object.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p><code>integer</code> minimum number of neighbors for selected
planning units in the solution. For problems with multiple zones,
the argument to <code>k</code> must have an element for each zone.</p></td>
    </tr>
    <tr>
      <th>zones</th>
      <td><p><code>matrix</code> or <code>Matrix</code> object describing the
neighborhood scheme for different zones. Each row and column corresponds
to a different zone in the argument to <code>x</code>, and cell values must
contain binary <code>numeric</code> values (i.e. one or zero) that indicate
if neighboring planning units (as specified in the argument to
<code>data</code>) should be considered neighbors if they are allocated to
different zones. The cell values along the diagonal
of the matrix indicate if planning units that are allocated to the same
zone should be considered neighbors or not. The default argument to
<code>zones</code> is an identity matrix (i.e. a matrix with ones along the
matrix diagonal and zeros elsewhere), so that planning units are
only considered neighbors if they are both allocated to the same zone.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p><code>NULL</code>, <code>matrix</code>, <code>Matrix</code>, <code>data.frame</code>, or
<code>array</code> object showing which planning units are neighbors with each
other. The argument defaults to <code>NULL</code> which means that the
neighborhood data is calculated automatically using the
<code><a href='connected_matrix.html'>connected_matrix</a></code> function. See the Details section for more
information.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code><a href='ConservationProblem-class.html'>ConservationProblem-class</a></code> object with the constraint
  added to it.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function uses neighborhood data identify solutions that
  surround planning units with a minimum number of neighbors. It
  was inspired by one of the mathematical formulations detailed in
  Billionnet (2013).</p>
<p>The argument to <code>data</code> can be specified in several ways:</p>
<p></p><dl class='dl-horizontal'>
    <dt><code>NULL</code></dt><dd><p>neighborhood data should be calculated automatically
    using the <code><a href='connected_matrix.html'>connected_matrix</a></code> function. This is the default
    argument. Note that the neighborhood data must be manually defined
    using one of the other formats below when the planning unit data
    in the argument to <code>x</code> is not spatially referenced (e.g.
    in <code>data.frame</code> or <code>numeric</code> format).</p></dd>
    <dt><code>matrix</code>, <code>Matrix</code></dt><dd><p>where rows and columns represent
    different planning units and the value of each cell indicates if the
    two planning units are neighbors or not. Cell values should be binary
    <code>numeric</code> values (i.e. one or zero). Cells that occur along the
    matrix diagonal have no effect on the solution at all because each
    planning unit cannot be a neighbor with itself.</p></dd>
    <dt><code>data.frame</code></dt><dd><p>containing the fields (columns)
    <code>"id1"</code>, <code>"id2"</code>, and <code>"boundary"</code>. Here, each row
    denotes the connectivity between two planning units following the
    <em>Marxan</em> format. The field <code>boundary</code> should contain
    binary <code>numeric</code> values that indicate if the two planning units
    specified in the fields <code>"id1"</code> and <code>"id2"</code> are neighbors
    or not. This data can be used to describe symmetric or
    asymmetric relationships between planning units. By default,
    input data is assumed to be symmetric unless asymmetric data is
    also included (e.g. if data is present for planning units 2 and 3, then
    the same amount of connectivity is expected for planning units 3 and 2,
    unless connectivity data is also provided for planning units 3 and 2).
    If the argument to <code>x</code> contains multiple zones, then the columns
    <code>"zone1"</code> and <code>"zone2"</code> can optionally be provided to manually
    specify if the neighborhood data pertain to specific zones. The fields
    <code>"zone1"</code> and <code>"zone2"</code> should contain the <code>character</code>
    names of the zones. If the columns <code>"zone1"</code> and <code>"zone2"</code>
    are present, then the argument to <code>zones</code> must be <code>NULL</code>.</p></dd>
    <dt><code>array</code></dt><dd><p>containing four-dimensions where binary
    <code>numeric</code> values indicate if planning unit should be treated
    as being neighbors with every other planning unit when they
    are allocated to every combination of management zone. The first two
    dimensions (i.e. rows and columns) correspond to the planning units,
    and second two dimensions correspond to the management zones. For
    example, if the argument to <code>data</code> had a value of 1 at the index
    <code>data[1, 2, 3, 4]</code> this would indicate that planning unit 1 and
    planning unit 2 should be treated as neighbors when they are
    allocated to zones 3 and 4 respectively.</p></dd>
    </dl>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Billionnet A (2013) Mathematical optimization ideas for biodiversity
conservation. <em>European Journal of Operational Research</em>, 231:
514--534.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='constraints.html'>constraints</a></code>, <code><a href='penalties.html'>penalties</a></code>.</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># load data</span>
<span class='fu'>data</span>(<span class='no'>sim_pu_raster</span>, <span class='no'>sim_features</span>, <span class='no'>sim_pu_zones_stack</span>, <span class='no'>sim_features_zones</span>)

<span class='co'># create minimal problem</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='fu'>problem</span>(<span class='no'>sim_pu_raster</span>, <span class='no'>sim_features</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_min_set_objective</span>() <span class='kw'>%&gt;%</span>
      <span class='fu'>add_relative_targets</span>(<span class='fl'>0.1</span>)

<span class='co'># create problem with constraints that require 1 neighbor</span>
<span class='co'># and neighbors are defined using a rook-style neighborhood</span>
<span class='no'>p2</span> <span class='kw'>&lt;-</span> <span class='no'>p1</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_neighbor_constraints</span>(<span class='fl'>1</span>)

<span class='co'># create problem with constraints that require 2 neighbor</span>
<span class='co'># and neighbors are defined using a rook-style neighborhood</span>
<span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='no'>p1</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_neighbor_constraints</span>(<span class='fl'>2</span>)

<span class='co'># create problem with constraints that require 3 neighbor</span>
<span class='co'># and neighbors are defined using a queen-style neighborhood</span>
<span class='no'>p4</span> <span class='kw'>&lt;-</span> <span class='no'>p1</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_neighbor_constraints</span>(<span class='fl'>3</span>,
               <span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'><a href='connected_matrix.html'>connected_matrix</a></span>(<span class='no'>sim_pu_raster</span>, <span class='kw'>directions</span> <span class='kw'>=</span> <span class='fl'>8</span>))</div><div class='input'><span class='co'># solve problems</span>
<span class='no'>s1</span> <span class='kw'>&lt;-</span> <span class='fu'>stack</span>(<span class='fu'>list</span>(<span class='fu'>solve</span>(<span class='no'>p1</span>), <span class='fu'>solve</span>(<span class='no'>p2</span>), <span class='fu'>solve</span>(<span class='no'>p3</span>), <span class='fu'>solve</span>(<span class='no'>p4</span>)))</div><div class='output co'>#&gt; Optimize a model with 5 rows, 90 columns and 450 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 9e-01]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [3e+00, 8e+00]
#&gt; Found heuristic solution: objective 2337.9617505
#&gt; Presolve time: 0.00s
#&gt; Presolved: 5 rows, 90 columns, 450 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Presolved: 5 rows, 90 columns, 450 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.924252e+03, 13 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 1924.25198    0    4 2337.96175 1924.25198  17.7%     -    0s
#&gt; H    0     0                    1979.9609382 1924.25198  2.81%     -    0s
#&gt; 
#&gt; Explored 1 nodes (13 simplex iterations) in 0.00 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 1979.96 2337.96 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 1.979960938178e+03, best bound 1.924251977336e+03, gap 2.8136%
#&gt; Optimize a model with 95 rows, 90 columns and 828 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [3e+00, 8e+00]
#&gt; Found heuristic solution: objective 2183.0924422
#&gt; Presolve time: 0.00s
#&gt; Presolved: 95 rows, 90 columns, 828 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Presolved: 95 rows, 90 columns, 828 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.924823e+03, 14 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 1924.82315    0    5 2183.09244 1924.82315  11.8%     -    0s
#&gt; H    0     0                    1982.4157068 1924.82315  2.91%     -    0s
#&gt; 
#&gt; Explored 1 nodes (14 simplex iterations) in 0.00 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 1982.42 2183.09 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 1.982415706799e+03, best bound 1.924823151914e+03, gap 2.9052%
#&gt; Optimize a model with 95 rows, 90 columns and 828 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 2e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [3e+00, 8e+00]
#&gt; Found heuristic solution: objective 3394.7345864
#&gt; Presolve removed 2 rows and 4 columns
#&gt; Presolve time: 0.00s
#&gt; Presolved: 93 rows, 86 columns, 798 nonzeros
#&gt; Variable types: 0 continuous, 86 integer (86 binary)
#&gt; Presolved: 93 rows, 86 columns, 798 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.939606e+03, 43 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 1939.60631    0   18 3394.73459 1939.60631  42.9%     -    0s
#&gt; H    0     0                    2450.3175793 1939.60631  20.8%     -    0s
#&gt; H    0     0                    2368.0045590 1939.60631  18.1%     -    0s
#&gt;      0     0 1947.32573    0   22 2368.00456 1947.32573  17.8%     -    0s
#&gt; H    0     0                    2282.2910206 1947.32573  14.7%     -    0s
#&gt; H    0     0                    2253.2782866 1947.32573  13.6%     -    0s
#&gt;      0     0 1995.12923    0   14 2253.27829 1995.12923  11.5%     -    0s
#&gt;      0     0 1995.82942    0   15 2253.27829 1995.82942  11.4%     -    0s
#&gt;      0     0 1999.36816    0   11 2253.27829 1999.36816  11.3%     -    0s
#&gt;      0     0 1999.47043    0   11 2253.27829 1999.47043  11.3%     -    0s
#&gt;      0     0 1999.98099    0   12 2253.27829 1999.98099  11.2%     -    0s
#&gt;      0     0 2000.75850    0   26 2253.27829 2000.75850  11.2%     -    0s
#&gt;      0     0 2001.03906    0   23 2253.27829 2001.03906  11.2%     -    0s
#&gt;      0     0 2001.15429    0   27 2253.27829 2001.15429  11.2%     -    0s
#&gt;      0     2 2001.29633    0   27 2253.27829 2001.29633  11.2%     -    0s
#&gt; H   22    17                    2023.4740746 2003.08458  1.01%   8.6    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 4
#&gt;   Cover: 11
#&gt;   MIR: 6
#&gt;   Zero half: 1
#&gt; 
#&gt; Explored 22 nodes (321 simplex iterations) in 0.07 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 6: 2023.47 2253.28 2282.29 ... 3394.73
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 2.023474074559e+03, best bound 2.003084584017e+03, gap 1.0076%
#&gt; Optimize a model with 95 rows, 90 columns and 1084 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 3e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [3e+00, 8e+00]
#&gt; Found heuristic solution: objective 2746.9251892
#&gt; Presolve removed 1 rows and 1 columns
#&gt; Presolve time: 0.00s
#&gt; Presolved: 94 rows, 89 columns, 1074 nonzeros
#&gt; Variable types: 0 continuous, 89 integer (89 binary)
#&gt; Presolved: 94 rows, 89 columns, 1074 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.933815e+03, 31 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 1933.81530    0   15 2746.92519 1933.81530  29.6%     -    0s
#&gt; H    0     0                    2431.2089197 1933.81530  20.5%     -    0s
#&gt;      0     0 1989.14533    0   13 2431.20892 1989.14533  18.2%     -    0s
#&gt; H    0     0                    2431.1303256 1989.14533  18.2%     -    0s
#&gt; H    0     0                    2412.3713574 1989.14533  17.5%     -    0s
#&gt;      0     0 1989.26829    0   15 2412.37136 1989.26829  17.5%     -    0s
#&gt;      0     0 1993.15633    0   20 2412.37136 1993.15633  17.4%     -    0s
#&gt; H    0     0                    2410.1031150 1993.15633  17.3%     -    0s
#&gt;      0     0 1993.37579    0   19 2410.10311 1993.37579  17.3%     -    0s
#&gt;      0     0 1994.01254    0   19 2410.10311 1994.01254  17.3%     -    0s
#&gt;      0     0 1994.55619    0   23 2410.10311 1994.55619  17.2%     -    0s
#&gt; H    0     0                    2374.0560071 1994.55619  16.0%     -    0s
#&gt;      0     0 1994.59191    0   24 2374.05601 1994.59191  16.0%     -    0s
#&gt;      0     0 1994.74679    0   22 2374.05601 1994.74679  16.0%     -    0s
#&gt;      0     2 1995.09827    0   22 2374.05601 1995.09827  16.0%     -    0s
#&gt; H  312   161                    2222.0732342 2011.78830  9.46%   7.9    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 3
#&gt;   Cover: 47
#&gt;   MIR: 10
#&gt;   Mod-K: 2
#&gt; 
#&gt; Explored 312 nodes (2573 simplex iterations) in 0.12 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 7: 2222.07 2374.06 2410.1 ... 2746.93
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 2.222073234223e+03, best bound 2.011788301932e+03, gap 9.4635%</div><div class='input'>
<span class='co'># plot solutions</span>
<span class='fu'>plot</span>(<span class='no'>s1</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
     <span class='kw'>main</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"basic solution"</span>, <span class='st'>"1 neighbor"</span>, <span class='st'>"2 neighbors"</span>, <span class='st'>"3 neighbors"</span>))</div><div class='img'><img src='add_neighbor_constraints-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># create minimal problem with multiple zones</span>
<span class='no'>p5</span> <span class='kw'>&lt;-</span> <span class='fu'>problem</span>(<span class='no'>sim_pu_zones_stack</span>, <span class='no'>sim_features_zones</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_min_set_objective</span>() <span class='kw'>%&gt;%</span>
      <span class='fu'>add_relative_targets</span>(<span class='fu'>matrix</span>(<span class='fl'>0.1</span>, <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='fl'>5</span>))

<span class='co'># create problem where selected planning units require at least 2 neighbors</span>
<span class='co'># for each zone and planning units are only considered neighbors if they</span>
<span class='co'># are allocated to the same zone</span>
<span class='no'>z6</span> <span class='kw'>&lt;-</span> <span class='fu'>diag</span>(<span class='fl'>3</span>)
<span class='fu'>print</span>(<span class='no'>z6</span>)</div><div class='output co'>#&gt;      [,1] [,2] [,3]
#&gt; [1,]    1    0    0
#&gt; [2,]    0    1    0
#&gt; [3,]    0    0    1</div><div class='input'><span class='no'>p6</span> <span class='kw'>&lt;-</span> <span class='no'>p5</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_neighbor_constraints</span>(<span class='fu'>rep</span>(<span class='fl'>2</span>, <span class='fl'>3</span>), <span class='no'>z6</span>)

<span class='co'># create problem where the planning units in zone 1 don't explicitly require</span>
<span class='co'># any neighbors, planning units in zone 2 require at least 1 neighbors, and</span>
<span class='co'># planning units in zone 3 require at least 2 neighbors. As before, planning</span>
<span class='co'># units are still only considered neighbors if they are allocated to the</span>
<span class='co'># same zone</span>
<span class='no'>p7</span> <span class='kw'>&lt;-</span> <span class='no'>p5</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_neighbor_constraints</span>(<span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>2</span>), <span class='no'>z6</span>)

<span class='co'># create problem given the same constraints as outlined above, except</span>
<span class='co'># that when determining which selected planning units are neighbors,</span>
<span class='co'># planning units that are allocated to zone 1 and zone 2 can also treated</span>
<span class='co'># as being neighbors with each other</span>
<span class='no'>z8</span> <span class='kw'>&lt;-</span> <span class='fu'>diag</span>(<span class='fl'>3</span>)
<span class='no'>z8</span>[<span class='fl'>1</span>, <span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>z8</span>[<span class='fl'>2</span>, <span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='fu'>print</span>(<span class='no'>z8</span>)</div><div class='output co'>#&gt;      [,1] [,2] [,3]
#&gt; [1,]    1    1    0
#&gt; [2,]    1    1    0
#&gt; [3,]    0    0    1</div><div class='input'><span class='no'>p8</span> <span class='kw'>&lt;-</span> <span class='no'>p5</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_neighbor_constraints</span>(<span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>2</span>), <span class='no'>z8</span>)</div><div class='input'><span class='co'># solve problems</span>
<span class='no'>s2</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='no'>p5</span>, <span class='no'>p6</span>, <span class='no'>p7</span>, <span class='no'>p8</span>)
<span class='no'>s2</span> <span class='kw'>&lt;-</span> <span class='fu'>lapply</span>(<span class='no'>s2</span>, <span class='no'>solve</span>)</div><div class='output co'>#&gt; Optimize a model with 105 rows, 270 columns and 1620 nonzeros
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 8e+00]
#&gt; Found heuristic solution: objective 6831.3431381
#&gt; Presolve time: 0.00s
#&gt; Presolved: 105 rows, 270 columns, 1620 nonzeros
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Presolved: 105 rows, 270 columns, 1620 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 5.950934e+03, 79 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 5950.93434    0   11 6831.34314 5950.93434  12.9%     -    0s
#&gt; H    0     0                    6078.1123440 5950.93434  2.09%     -    0s
#&gt; 
#&gt; Explored 1 nodes (79 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 6078.11 6831.34 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 6.078112344026e+03, best bound 5.950934338290e+03, gap 2.0924%
#&gt; Optimize a model with 375 rows, 270 columns and 2760 nonzeros
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 2e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 8e+00]
#&gt; Found heuristic solution: objective 8537.2927605
#&gt; Presolve removed 6 rows and 9 columns
#&gt; Presolve time: 0.01s
#&gt; Presolved: 369 rows, 261 columns, 2685 nonzeros
#&gt; Variable types: 0 continuous, 261 integer (261 binary)
#&gt; Presolved: 369 rows, 261 columns, 2685 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 5.971151e+03, 267 iterations, 0.01 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 5971.15051    0   46 8537.29276 5971.15051  30.1%     -    0s
#&gt; H    0     0                    6710.6438036 5971.15051  11.0%     -    0s
#&gt; H    0     0                    6707.2996384 5971.15051  11.0%     -    0s
#&gt;      0     0 5979.93204    0   46 6707.29964 5979.93204  10.8%     -    0s
#&gt; H    0     0                    6700.4815824 5979.93204  10.8%     -    0s
#&gt;      0     0 6032.77799    0   48 6700.48158 6032.77799  10.0%     -    0s
#&gt;      0     0 6035.00381    0   55 6700.48158 6035.00381  9.93%     -    0s
#&gt;      0     0 6035.78922    0   56 6700.48158 6035.78922  9.92%     -    0s
#&gt;      0     0 6036.05774    0   49 6700.48158 6036.05774  9.92%     -    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 7
#&gt;   Cover: 25
#&gt;   Clique: 3
#&gt;   MIR: 9
#&gt;   StrongCG: 1
#&gt;   Zero half: 1
#&gt; 
#&gt; Explored 1 nodes (508 simplex iterations) in 0.05 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 4: 6700.48 6707.3 6710.64 8537.29 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 6.700481582399e+03, best bound 6.036057740789e+03, gap 9.9161%
#&gt; Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
#&gt; Optimize a model with 375 rows, 270 columns and 2670 nonzeros
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 2e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 8e+00]
#&gt; Found heuristic solution: objective 7080.5111326
#&gt; Presolve removed 91 rows and 3 columns
#&gt; Presolve time: 0.01s
#&gt; Presolved: 284 rows, 267 columns, 2357 nonzeros
#&gt; Variable types: 0 continuous, 267 integer (267 binary)
#&gt; Presolved: 284 rows, 267 columns, 2357 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 5.956651e+03, 156 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 5956.65139    0   30 7080.51113 5956.65139  15.9%     -    0s
#&gt; H    0     0                    6543.3159914 5956.65139  8.97%     -    0s
#&gt; 
#&gt; Explored 1 nodes (156 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 6543.32 7080.51 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 6.543315991396e+03, best bound 5.956651389956e+03, gap 8.9659%
#&gt; Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
#&gt; Optimize a model with 375 rows, 270 columns and 3250 nonzeros
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 2e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 8e+00]
#&gt; Found heuristic solution: objective 7515.3300140
#&gt; Presolve removed 91 rows and 3 columns
#&gt; Presolve time: 0.01s
#&gt; Presolved: 284 rows, 267 columns, 2647 nonzeros
#&gt; Variable types: 0 continuous, 267 integer (267 binary)
#&gt; Presolved: 284 rows, 267 columns, 2647 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 5.956231e+03, 165 iterations, 0.01 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 5956.23080    0   26 7515.33001 5956.23080  20.7%     -    0s
#&gt; H    0     0                    6509.2489699 5956.23080  8.50%     -    0s
#&gt; 
#&gt; Explored 1 nodes (165 simplex iterations) in 0.02 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 6509.25 7515.33 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 6.509248969868e+03, best bound 5.956230798547e+03, gap 8.4959%</div><div class='input'><span class='no'>s2</span> <span class='kw'>&lt;-</span> <span class='fu'>lapply</span>(<span class='no'>s2</span>, <span class='no'>category_layer</span>)
<span class='no'>s2</span> <span class='kw'>&lt;-</span> <span class='fu'>stack</span>(<span class='no'>s2</span>)
<span class='fu'>names</span>(<span class='no'>s2</span>) <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"basic problem"</span>, <span class='st'>"p6"</span>, <span class='st'>"p7"</span>, <span class='st'>"p8"</span>)

<span class='co'># plot solutions</span>
<span class='fu'>plot</span>(<span class='no'>s2</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='fu'>names</span>(<span class='no'>s2</span>), <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='img'><img src='add_neighbor_constraints-2.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://jeffrey-hanson.com'>Jeffrey O Hanson</a>, <a href='http://www.richard-schuster.com/'>Richard Schuster</a>, Nina Morrell, <a href='http://strimas.com'>Matthew Strimas-Mackey</a>, Matthew E Watts, <a href='http://arcese.forestry.ubc.ca'>Peter Arcese</a>, <a href='https://josephrbennett.wordpress.com/'>Joeseph Bennett</a>, Hugh P Possingham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control'
  });
</script>


  </body>
</html>

