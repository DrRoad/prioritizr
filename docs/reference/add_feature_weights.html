<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add feature weights — add_feature_weights • prioritizr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Add feature weights — add_feature_weights" />

<meta property="og:description" content="Conservation planning problems that aim to maximize the
representation of features given a budget often will not able to conserve
all of the features unless the budget is very high. In such budget-limited
problems, it may be desirable to prefer the representation of some features
over other features. This information can be incorporated into the problem
using weights. Weights can be applied to a problem to favor the
representation of some features over other features when making decisions
about how the budget should be allocated." />

<meta property="og:image" content="http://prioritizr.github.io/prioritizr/logo.png" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">4.0.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/gurobi_installation.html">Gurobi Installation Guide</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication Record</a>
    </li>
    <li>
      <a href="../articles/zones.html">Management Zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/prioritizr/prioritizr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add feature weights</h1>
    <small>Source: <a href='https://github.com/prioritizr/prioritizr/blob/master/R/add_feature_weights.R'><code>R/add_feature_weights.R</code></a></small>
    <div class="hidden name"><code>add_feature_weights.Rd</code></div>
    </div>

    
    <p>Conservation planning problems that aim to maximize the
representation of features given a budget often will not able to conserve
all of the features unless the budget is very high. In such budget-limited
problems, it may be desirable to prefer the representation of some features
over other features. This information can be incorporated into the problem
using weights. Weights can be applied to a problem to favor the
representation of some features over other features when making decisions
about how the budget should be allocated.</p>
    

    <pre class="usage"><span class='co'># S4 method for ConservationProblem,numeric</span>
<span class='fu'>add_feature_weights</span>(<span class='no'>x</span>, <span class='no'>weights</span>)

<span class='co'># S4 method for ConservationProblem,matrix</span>
<span class='fu'>add_feature_weights</span>(<span class='no'>x</span>, <span class='no'>weights</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code><a href='ConservationProblem-class.html'>ConservationProblem-class</a></code> object.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p><code>numeric</code> or <code>matrix</code> of weights. See the
Details section for more information.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code><a href='ConservationProblem-class.html'>ConservationProblem-class</a></code> object with the weights
  added to it.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Weights can only be applied to problems that have an objective
  that is budget limited (e.g. <code>add_max_cover_objective</code>). #'
  They can be applied to problems that aim to maximize phylogenetic
  representation (<code>add_max_phylo_objective</code>) to favor the
  representation of specific features over the representation of
  some phylogenetic branches. Weights cannot be negative values
  and must have values that are equal to or larger than zero.
  <strong>Note that planning unit costs are scaled to 0.01 to identify
  the cheapest solution among multiple optimal solutions. This means
  that the optimization process will favor cheaper solutions over solutions
  that meet feature targets (or occurrences) when feature weights are
  lower than 0.01.</strong></p>
<p></p><dl class='dl-horizontal'>
    <dt><code>numeric</code></dt><dd><p>containing weights for each feature. Note that this
    type of argument cannot be used to specify weights for problems with
    multiple zones.</p></dd>
    <dt><code>matrix</code></dt><dd><p>containing weights for each feature in each zone.
     Here, each row corresponds to a different feature in argument to
     <code>x</code>, each column corresponds to a different zone in argument to
     <code>x</code>, and each cell contains the weight value for a given feature
     that the solution can to secure in a given zone. Note that
     if the problem contains targets created using
     <code>add_manual_targets</code> then a <code>matrix</code> should be
     supplied containing a single column that indicates that weight for
     fulfilling each target.</p></dd>
    </dl>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='objectives.html'>objectives</a></code>.</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># load data</span>
<span class='fu'>data</span>(<span class='no'>sim_pu_raster</span>, <span class='no'>sim_features</span>, <span class='no'>sim_phylogeny</span>, <span class='no'>sim_pu_zones_stack</span>,
     <span class='no'>sim_features_zones</span>)

<span class='co'># create minimal problem that aims to maximize the number of features</span>
<span class='co'># adequately conserved given a total budget of 3800. Here, each feature</span>
<span class='co'># needs 20 % of its habitat for it to be considered adequately conserved</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='fu'>problem</span>(<span class='no'>sim_pu_raster</span>, <span class='no'>sim_features</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_max_features_objective</span>(<span class='kw'>budget</span> <span class='kw'>=</span> <span class='fl'>3800</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_relative_targets</span>(<span class='fl'>0.2</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_binary_decisions</span>()

<span class='co'># create weights that assign higher importance to features with less</span>
<span class='co'># suitable habitat in the study area</span>
(<span class='no'>w2</span> <span class='kw'>&lt;-</span> <span class='fu'>exp</span>((<span class='fl'>1</span> / <span class='fu'>cellStats</span>(<span class='no'>sim_features</span>, <span class='st'>"sum"</span>)) * <span class='fl'>200</span>))</div><div class='output co'>#&gt;   layer.1   layer.2   layer.3   layer.4   layer.5 
#&gt;  11.06620 611.48875  16.03665 107.27609  33.97546 </div><div class='input'>
<span class='co'># create problem using rarity weights</span>
<span class='no'>p2</span> <span class='kw'>&lt;-</span> <span class='no'>p1</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_feature_weights</span>(<span class='no'>w2</span>)

<span class='co'># create manually specified weights that assign higher importance to</span>
<span class='co'># certain features. These weights could be based on a pre-calculated index</span>
<span class='co'># (e.g. an index measuring extinction risk where higher values</span>
<span class='co'># denote higher extinction risk)</span>
<span class='no'>w3</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>100</span>, <span class='fl'>200</span>)
<span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='no'>p1</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_feature_weights</span>(<span class='no'>w3</span>)</div><div class='input'><span class='co'># solve problems</span>
<span class='no'>s1</span> <span class='kw'>&lt;-</span> <span class='fu'>stack</span>(<span class='fu'>solve</span>(<span class='no'>p1</span>), <span class='fu'>solve</span>(<span class='no'>p2</span>), <span class='fu'>solve</span>(<span class='no'>p3</span>))</div><div class='output co'>#&gt; Optimize a model with 6 rows, 95 columns and 545 nonzeros
#&gt; Variable types: 0 continuous, 95 integer (95 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 2e+02]
#&gt;   Objective range  [1e-04, 1e+00]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [4e+03, 4e+03]
#&gt; Found heuristic solution: objective -0.0000000
#&gt; Presolve time: 0.00s
#&gt; Presolved: 6 rows, 95 columns, 545 nonzeros
#&gt; Variable types: 0 continuous, 95 integer (95 binary)
#&gt; Presolved: 6 rows, 95 columns, 545 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 4.910074e+00, 22 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0    4.91007    0    6   -0.00000    4.91007      -     -    0s
#&gt; H    0     0                       2.9979848    4.91007  63.8%     -    0s
#&gt;      0     0    4.90982    0    8    2.99798    4.90982  63.8%     -    0s
#&gt;      0     0    4.90935    0    8    2.99798    4.90935  63.8%     -    0s
#&gt;      0     0    4.90928    0    9    2.99798    4.90928  63.8%     -    0s
#&gt;      0     0    4.90837    0   11    2.99798    4.90837  63.7%     -    0s
#&gt;      0     0    4.90831    0   12    2.99798    4.90831  63.7%     -    0s
#&gt;      0     0    4.90769    0   10    2.99798    4.90769  63.7%     -    0s
#&gt;      0     0    4.90750    0   10    2.99798    4.90750  63.7%     -    0s
#&gt;      0     0    4.90741    0   12    2.99798    4.90741  63.7%     -    0s
#&gt;      0     0    4.90673    0   12    2.99798    4.90673  63.7%     -    0s
#&gt;      0     0    4.90669    0   12    2.99798    4.90669  63.7%     -    0s
#&gt;      0     0    4.90640    0   13    2.99798    4.90640  63.7%     -    0s
#&gt;      0     0    4.90629    0   12    2.99798    4.90629  63.7%     -    0s
#&gt;      0     0    4.90569    0   12    2.99798    4.90569  63.6%     -    0s
#&gt;      0     0    4.90547    0   14    2.99798    4.90547  63.6%     -    0s
#&gt;      0     0    4.90539    0   15    2.99798    4.90539  63.6%     -    0s
#&gt;      0     2    4.90506    0   15    2.99798    4.90506  63.6%     -    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   MIR: 6
#&gt;   StrongCG: 3
#&gt; 
#&gt; Explored 81 nodes (333 simplex iterations) in 0.03 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 2.99798 -0 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 2.997984769855e+00, best bound 3.016746954217e+00, gap 0.6258%
#&gt; Optimize a model with 6 rows, 95 columns and 545 nonzeros
#&gt; Variable types: 0 continuous, 95 integer (95 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 2e+02]
#&gt;   Objective range  [1e-04, 6e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [4e+03, 4e+03]
#&gt; Found heuristic solution: objective -0.0000000
#&gt; Presolve time: 0.00s
#&gt; Presolved: 6 rows, 95 columns, 545 nonzeros
#&gt; Variable types: 0 continuous, 95 integer (95 binary)
#&gt; Presolved: 6 rows, 95 columns, 545 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 7.777044e+02, 19 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0  777.70445    0    6   -0.00000  777.70445      -     -    0s
#&gt;      0     0  777.60525    0    7   -0.00000  777.60525      -     -    0s
#&gt;      0     0  777.42467    0    6   -0.00000  777.42467      -     -    0s
#&gt;      0     0  777.40672    0    8   -0.00000  777.40672      -     -    0s
#&gt;      0     0  777.35146    0    9   -0.00000  777.35146      -     -    0s
#&gt;      0     0  777.33723    0   11   -0.00000  777.33723      -     -    0s
#&gt;      0     0  777.29475    0   11   -0.00000  777.29475      -     -    0s
#&gt;      0     0  777.27067    0   11   -0.00000  777.27067      -     -    0s
#&gt;      0     0  777.17530    0    8   -0.00000  777.17530      -     -    0s
#&gt;      0     0  777.16772    0   10   -0.00000  777.16772      -     -    0s
#&gt;      0     0  777.16203    0   10   -0.00000  777.16203      -     -    0s
#&gt;      0     0  777.16201    0   11   -0.00000  777.16201      -     -    0s
#&gt;      0     0  777.15998    0   13   -0.00000  777.15998      -     -    0s
#&gt;      0     2  777.13494    0   13   -0.00000  777.13494      -     -    0s
#&gt; H    7     1                     718.7628283  718.76388  0.00%  13.4    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Cover: 3
#&gt;   MIR: 4
#&gt;   StrongCG: 1
#&gt; 
#&gt; Explored 7 nodes (167 simplex iterations) in 0.02 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 718.763 -0 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 7.187628282971e+02, best bound 7.187638759139e+02, gap 0.0001%
#&gt; Optimize a model with 6 rows, 95 columns and 545 nonzeros
#&gt; Variable types: 0 continuous, 95 integer (95 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 2e+02]
#&gt;   Objective range  [1e-04, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [4e+03, 4e+03]
#&gt; Found heuristic solution: objective -0.0000000
#&gt; Presolve removed 3 rows and 3 columns
#&gt; Presolve time: 0.00s
#&gt; Presolved: 3 rows, 92 columns, 272 nonzeros
#&gt; Variable types: 0 continuous, 92 integer (92 binary)
#&gt; Presolved: 3 rows, 92 columns, 272 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 2.999981e+02, 26 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0  299.99809    0    2   -0.00000  299.99809      -     -    0s
#&gt; H    0     0                     299.9980377  299.99809  0.00%     -    0s
#&gt; 
#&gt; Explored 1 nodes (26 simplex iterations) in 0.00 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 299.998 -0 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 2.999980376769e+02, best bound 2.999980891659e+02, gap 0.0000%</div><div class='input'>
<span class='co'># plot solutions</span>
<span class='fu'>plot</span>(<span class='no'>s1</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"equal weights"</span>, <span class='st'>"rarity weights"</span>, <span class='st'>"manual weights"</span>),
     <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='img'><img src='add_feature_weights-1.png' alt='' width='700' height='433' /></div><div class='input'># the ape package needs to be installed to run this example
if (require("ape")) {
  # plot the example phylogeny
  par(mfrow = c(1, 1))
  plot(sim_phylogeny, main = "simulated phylogeny")

  # create problem with a maximum phylogenetic representation objective,
  # where each feature needs 10 % of its distribution to be secured for
  # it to be adequately conserved and a total budget of 1900
  p4 <- problem(sim_pu_raster, sim_features) %>%
        add_max_phylo_objective(1900, sim_phylogeny) %>%
        add_relative_targets(0.1) %>%
        add_binary_decisions()
</div><div class='output co'>#&gt; <span class='error'>Error: &lt;text&gt;:15:0: unexpected end of input</span>
#&gt; <span class='error'>13:         add_binary_decisions()</span>
#&gt; <span class='error'>14: </span>
#&gt; <span class='error'>   ^</span></div><div class='input'>  <span class='co'># solve problem</span>
  <span class='no'>s4</span> <span class='kw'>&lt;-</span> <span class='fu'>solve</span>(<span class='no'>p4</span>)</div><div class='output co'>#&gt; <span class='error'>Error in solve(p4): object 'p4' not found</span></div><div class='input'>
  <span class='co'># plot solution</span>
  <span class='fu'>plot</span>(<span class='no'>s4</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"solution"</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='error'>Error in plot(s4, main = "solution", axes = FALSE, box = FALSE): object 's4' not found</span></div><div class='input'>
  <span class='co'># find which features have their targets met</span>
  <span class='no'>targets_met4</span> <span class='kw'>&lt;-</span> <span class='fu'>cellStats</span>(<span class='no'>s4</span> * <span class='no'>sim_features</span>, <span class='st'>"sum"</span>) <span class='kw'>&gt;</span>
                  (<span class='fl'>0.1</span> * <span class='fu'>cellStats</span>(<span class='no'>sim_features</span>, <span class='st'>"sum"</span>))</div><div class='output co'>#&gt; <span class='error'>Error in cellStats(s4 * sim_features, "sum"): object 's4' not found</span></div><div class='input'>
  <span class='co'># plot the example phylogeny and color the represented features in red</span>
  <span class='fu'>plot</span>(<span class='no'>sim_phylogeny</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"represented features"</span>,
       <span class='kw'>tip.color</span> <span class='kw'>=</span> <span class='fu'>replace</span>(<span class='fu'>rep</span>(<span class='st'>"black"</span>, <span class='fu'>nlayers</span>(<span class='no'>sim_features</span>)),
                           <span class='fu'>which</span>(<span class='no'>targets_met4</span>), <span class='st'>"red"</span>))</div><div class='output co'>#&gt; <span class='error'>Error in which(targets_met4): object 'targets_met4' not found</span></div><div class='img'><img src='add_feature_weights-2.png' alt='' width='700' height='433' /></div><div class='input'>  <span class='co'># we can see here that the third feature ("layer.3", i.e.</span>
  <span class='co'># sim_features[[3]]) is not represented in the solution. Let us pretend</span>
  <span class='co'># that it is absolutely critical this feature is adequately conserved</span>
  <span class='co'># in the solution. For example, this feature could represent a species</span>
  <span class='co'># that plays important role in the ecosystem, or a species that is</span>
  <span class='co'># important commercial activities (e.g. eco-tourism). So, to generate</span>
  <span class='co'># a solution that conserves the third feature whilst also aiming to</span>
  <span class='co'># maximize phylogenetic diversity, we will create a set of weights that</span>
  <span class='co'># assign a particularly high weighting to the third feature</span>
  <span class='no'>w5</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1000</span>, <span class='fl'>0</span>, <span class='fl'>0</span>)

  <span class='co'># we can see that this weighting (i.e. w5[3]) has a much higher value than</span>
  <span class='co'># the branch lengths in the phylogeny so solutions that represent this</span>
  <span class='co'># feature be much closer to optimality</span>
  <span class='fu'><a href='print.html'>print</a></span>(<span class='no'>sim_phylogeny</span>$<span class='no'>edge.length</span>)</div><div class='output co'>#&gt; [1] 0.92935310 0.04601484 0.19467348 0.42153320 0.83343759 0.48469318 0.85434472
#&gt; [8] 0.58924564</div><div class='input'>  <span class='co'># create problem with high weighting for the third feature and solve it</span>
  <span class='no'>s5</span> <span class='kw'>&lt;-</span> <span class='no'>p4</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_feature_weights</span>(<span class='no'>w5</span>) <span class='kw'>%&gt;%</span> <span class='fu'>solve</span>()</div><div class='output co'>#&gt; <span class='error'>Error in eval(lhs, parent, parent): object 'p4' not found</span></div><div class='input'>
  <span class='co'># plot solution</span>
  <span class='fu'>plot</span>(<span class='no'>s5</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"solution"</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='error'>Error in plot(s5, main = "solution", axes = FALSE, box = FALSE): object 's5' not found</span></div><div class='input'>
  <span class='co'># find which features have their targets met</span>
  <span class='no'>targets_met5</span> <span class='kw'>&lt;-</span> <span class='fu'>cellStats</span>(<span class='no'>s5</span> * <span class='no'>sim_features</span>, <span class='st'>"sum"</span>) <span class='kw'>&gt;</span>
                  (<span class='fl'>0.1</span> * <span class='fu'>cellStats</span>(<span class='no'>sim_features</span>, <span class='st'>"sum"</span>))</div><div class='output co'>#&gt; <span class='error'>Error in cellStats(s5 * sim_features, "sum"): object 's5' not found</span></div><div class='input'>
  <span class='co'># plot the example phylogeny and color the represented features in red</span>
  <span class='co'># here we can see that this solution only adequately conserves the</span>
  <span class='co'># third feature. This means that, given the budget, we are faced with the</span>
  <span class='co'># trade-off of conserving either the third feature, or a phylogenetically</span>
  <span class='co'># diverse set of three different features.</span>
  <span class='fu'>plot</span>(<span class='no'>sim_phylogeny</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"represented features"</span>,
       <span class='kw'>tip.color</span> <span class='kw'>=</span> <span class='fu'>replace</span>(<span class='fu'>rep</span>(<span class='st'>"black"</span>, <span class='fu'>nlayers</span>(<span class='no'>sim_features</span>)),
                           <span class='fu'>which</span>(<span class='no'>targets_met5</span>), <span class='st'>"red"</span>))</div><div class='output co'>#&gt; <span class='error'>Error in which(targets_met5): object 'targets_met5' not found</span></div><div class='img'><img src='add_feature_weights-3.png' alt='' width='700' height='433' /></div><div class='input'>}
# create multi-zone problem with maximum features objective,
# with 10 % representation targets for each feature, and set
# a budget such that the total maximum expenditure in all zones
# cannot exceed 3000
p6 <- problem(sim_pu_zones_stack, sim_features_zones) %>%
      add_max_features_objective(3000) %>%
      add_relative_targets(matrix(0.1, ncol = 3, nrow = 5)) %>%
      add_binary_decisions()

# create weights that assign equal weighting for the representation
# of each feature in each zone except that it does not matter if
# feature 1 is represented in zone 1 and it really important
# that feature 3 is really in zone 1
w7 <- matrix(1, ncol = 3, nrow = 5)
w7[1, 1] <- 0
w7[3, 1] <- 100

# create problem with weights
p7 <- p6 %>% add_feature_weights(w7)
</div><div class='output co'>#&gt; <span class='error'>Error: &lt;text&gt;:1:1: unexpected '}'</span>
#&gt; <span class='error'>1: }</span>
#&gt; <span class='error'>    ^</span></div><div class='input'><span class='co'># solve problems</span>
<span class='no'>s6</span> <span class='kw'>&lt;-</span> <span class='fu'>solve</span>(<span class='no'>p6</span>)</div><div class='output co'>#&gt; <span class='error'>Error in solve(p6): object 'p6' not found</span></div><div class='input'><span class='no'>s7</span> <span class='kw'>&lt;-</span> <span class='fu'>solve</span>(<span class='no'>p7</span>)</div><div class='output co'>#&gt; <span class='error'>Error in solve(p7): object 'p7' not found</span></div><div class='input'>
<span class='co'># plot solutions</span>
<span class='fu'>plot</span>(<span class='fu'>stack</span>(<span class='fu'><a href='category_layer.html'>category_layer</a></span>(<span class='no'>s6</span>), <span class='fu'><a href='category_layer.html'>category_layer</a></span>(<span class='no'>s7</span>)),
     <span class='kw'>main</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"equal weights"</span>, <span class='st'>"manual weights"</span>), <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='error'>Error in inherits(x, "Raster"): object 's6' not found</span></div><div class='input'><span class='co'># create minimal problem to show the correct method for setting</span>
<span class='co'># weights for problems with manual targets</span>
<span class='no'>p8</span> <span class='kw'>&lt;-</span> <span class='fu'>problem</span>(<span class='no'>sim_pu_raster</span>, <span class='no'>sim_features</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_max_features_objective</span>(<span class='kw'>budget</span> <span class='kw'>=</span> <span class='fl'>1500</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_manual_targets</span>(<span class='fu'>data.frame</span>(<span class='kw'>feature</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"layer.1"</span>, <span class='st'>"layer.4"</span>),
                                    <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"relative"</span>,
                                    <span class='kw'>target</span> <span class='kw'>=</span> <span class='fl'>0.1</span>)) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_feature_weights</span>(<span class='fu'>matrix</span>(<span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>200</span>), <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='fl'>1</span>)) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_binary_decisions</span>()</div><div class='input'><span class='co'># solve problem</span>
<span class='no'>s8</span> <span class='kw'>&lt;-</span> <span class='fu'>solve</span>(<span class='no'>p8</span>)</div><div class='output co'>#&gt; Optimize a model with 3 rows, 92 columns and 272 nonzeros
#&gt; Variable types: 0 continuous, 92 integer (92 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 2e+02]
#&gt;   Objective range  [1e-04, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [2e+03, 2e+03]
#&gt; Found heuristic solution: objective -0.0000000
#&gt; Presolve removed 1 rows and 1 columns
#&gt; Presolve time: 0.00s
#&gt; Presolved: 2 rows, 91 columns, 181 nonzeros
#&gt; Variable types: 0 continuous, 91 integer (91 binary)
#&gt; Presolved: 2 rows, 91 columns, 181 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.999992e+02, 9 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0  199.99922    0    1   -0.00000  199.99922      -     -    0s
#&gt; H    0     0                     199.9992051  199.99922  0.00%     -    0s
#&gt; 
#&gt; Explored 1 nodes (9 simplex iterations) in 0.00 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 199.999 -0 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 1.999992050854e+02, best bound 1.999992214035e+02, gap 0.0000%</div><div class='input'>
<span class='co'># plot solution</span>
<span class='fu'>plot</span>(<span class='no'>s8</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"solution"</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='img'><img src='add_feature_weights-4.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://jeffrey-hanson.com'>Jeffrey O Hanson</a>, <a href='http://www.richard-schuster.com/'>Richard Schuster</a>, Nina Morrell, <a href='http://strimas.com'>Matthew Strimas-Mackey</a>, Matthew E Watts, <a href='http://arcese.forestry.ubc.ca'>Peter Arcese</a>, <a href='https://josephrbennett.wordpress.com/'>Joeseph Bennett</a>, Hugh P Possingham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

